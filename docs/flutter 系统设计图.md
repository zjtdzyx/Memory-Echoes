# Flutter ç³»ç»Ÿè®¾è®¡å›¾ - è®°å¿†å›å“ (Memory Echoes)

> **æ–‡æ¡£æ›´æ–°çŠ¶æ€**: âœ… å·²ä¸å½“å‰å®ç°åŒæ­¥ (2024 å¹´ç‰ˆæœ¬)
> **å®ç°è¿›åº¦**: MVP æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼ŒåŒ…å« AI å¯¹è¯ã€æ•…äº‹ç®¡ç†ã€ä¼ è®°ç”Ÿæˆç­‰æ¨¡å—

## 1. ç³»ç»Ÿæ¶æ„å›¾

### å½“å‰å®ç°çŠ¶æ€ âœ…

**æ ¸å¿ƒç”¨æˆ·è§’è‰²ï¼š**

- **ç”¨æˆ· (User)**: âœ… å·²å®ç° - é€šè¿‡ Flutter App è¿›è¡Œäº¤äº’
- **ç®¡ç†å‘˜ (Admin)**: âœ… å·²å®ç° - é€šè¿‡ Firebase æ§åˆ¶å°ç®¡ç†
- **AI å†…å®¹ç”Ÿæˆ Agent**: âœ… å·²å®ç° - åŸºäº Gemini Pro çš„æ™ºèƒ½å¯¹è¯å’Œæ•…äº‹ç”Ÿæˆ

**æ ¸å¿ƒæŠ€æœ¯æ¨¡å—/æœåŠ¡ï¼š**

1. **Flutter App (å®¢æˆ·ç«¯)**: âœ… å·²å®ç°
2. **Firebase Authentication**: âœ… å·²å®ç° - é‚®ç®±/å¯†ç ç™»å½•æ³¨å†Œ
3. **Cloud Firestore**: âœ… å·²å®ç° - ç”¨æˆ·ã€æ•…äº‹ã€å¯¹è¯æ•°æ®å­˜å‚¨
4. **Firebase Storage**: âœ… å·²å®ç° - å›¾ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶å­˜å‚¨
5. **Google Gemini Pro API**: âœ… å·²å®ç° - AI å¯¹è¯å’Œæ•…äº‹ç”Ÿæˆ
6. **Firebase Cloud Functions**: ğŸš§ å¾…æ‰©å±• - åç»­å¯ç”¨äºå†…å®¹å®¡æ ¸

### ç³»ç»Ÿæ¶æ„æè¿°

å½“å‰ç³»ç»Ÿé‡‡ç”¨ **Clean Architecture** åˆ†å±‚è®¾è®¡ï¼ŒFlutter App ä½œä¸ºå®¢æˆ·ç«¯ä¸å¤šä¸ª Firebase æœåŠ¡å’Œ Google Gemini Pro API ç›´æ¥äº¤äº’ã€‚

\`\`\`mermaid
graph TB
    User[ç”¨æˆ· User] --> FlutterApp[Flutter App<br/>iOS/Android/Web å®¢æˆ·ç«¯]
    FlutterApp --> FirebaseAuth[Firebase Authentication<br/>ç”¨æˆ·æ³¨å†Œ/ç™»å½•/ä¼šè¯]
    FlutterApp --> Firestore[Cloud Firestore<br/>ç”¨æˆ·ã€æ•…äº‹ã€ä¼ è®°ã€<br/>ç‚¹èµã€æ”¶è—ã€å¯¹è¯ä¸Šä¸‹æ–‡]
    FlutterApp --> Storage[Firebase Storage<br/>ç”¨æˆ·å›¾ç‰‡/éŸ³é¢‘æ–‡ä»¶]
    FlutterApp --> GeminiAPI[Google Gemini Pro API<br/>æ ¸å¿ƒæ•…äº‹/ä¼ è®°ç”Ÿæˆï¼Œ<br/>å¼•å¯¼å¼æé—®]

    Admin[ç®¡ç†å‘˜ Admin] --> FirebaseConsole[Firebase æ§åˆ¶å°]
    FirebaseConsole --> FirebaseAuth
    FirebaseConsole --> Firestore
    FirebaseConsole --> Storage
    
    %% æœªæ¥æ‰©å±•
    CloudFunctions[Firebase Cloud Functions<br/>AI å†…å®¹å®¡æ ¸ Agent<br/>å¤æ‚ä¸šåŠ¡é€»è¾‘ç¼–æ’] -.-> Firestore
    CloudFunctions -.-> GeminiAPI
    Admin -.-> CloudFunctions
\`\`\`

### å½“å‰å®ç°çš„æ¨¡å—ç»“æ„ âœ…

åŸºäº Clean Architecture çš„ä¸‰å±‚ç»“æ„å·²å®Œå…¨å®ç°ï¼š

\`\`\`
lib/
â”œâ”€â”€ core/                        # âœ… æ ¸å¿ƒåŸºç¡€æ¨¡å—
â”‚   â”œâ”€â”€ constants/              # âœ… å…¨å±€å¸¸é‡ (ä¸»é¢˜ã€è·¯ç”±ç­‰)
â”‚   â”œâ”€â”€ errors/                 # âœ… é”™è¯¯å¤„ç†æœºåˆ¶
â”‚   â”œâ”€â”€ services/               # âœ… æ ¸å¿ƒæœåŠ¡ (æ–‡ä»¶ä¸Šä¼ ç­‰)
â”‚   â””â”€â”€ utils/                  # âœ… å·¥å…·å‡½æ•° (æ—¥æœŸæ ¼å¼åŒ–ã€éªŒè¯ç­‰)
â”œâ”€â”€ data/                       # âœ… æ•°æ®å±‚
â”‚   â”œâ”€â”€ datasources/            # âœ… æ•°æ®æº
â”‚   â”‚   â””â”€â”€ remote/            # âœ… è¿œç¨‹æ•°æ®æº
â”‚   â”‚       â”œâ”€â”€ firebase_auth_datasource.dart      # âœ… Firebase è®¤è¯
â”‚   â”‚       â”œâ”€â”€ firestore_story_datasource.dart    # âœ… Firestore æ•…äº‹æ•°æ®
â”‚   â”‚       â”œâ”€â”€ firebase_storage_datasource.dart   # âœ… æ–‡ä»¶å­˜å‚¨
â”‚   â”‚       â””â”€â”€ gemini_api_service.dart            # âœ… Gemini API æœåŠ¡
â”‚   â”œâ”€â”€ models/                 # âœ… æ•°æ®æ¨¡å‹ (Freezed + JSON)
â”‚   â”‚   â”œâ”€â”€ user_model.dart     # âœ… ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ story_model.dart    # âœ… æ•…äº‹æ¨¡å‹
â”‚   â”‚   â””â”€â”€ chat_message_model.dart  # âœ… èŠå¤©æ¶ˆæ¯æ¨¡å‹
â”‚   â””â”€â”€ repositories/           # âœ… ä»“åº“å®ç°
â”‚       â”œâ”€â”€ auth_repository_impl.dart     # âœ… è®¤è¯ä»“åº“
â”‚       â”œâ”€â”€ story_repository_impl.dart    # âœ… æ•…äº‹ä»“åº“
â”‚       â””â”€â”€ ai_repository_impl.dart       # âœ… AI ä»“åº“
â”œâ”€â”€ domain/                     # âœ… é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ entities/               # âœ… å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ user_entity.dart    # âœ… ç”¨æˆ·å®ä½“
â”‚   â”‚   â”œâ”€â”€ story_entity.dart   # âœ… æ•…äº‹å®ä½“
â”‚   â”‚   â”œâ”€â”€ chat_message_entity.dart  # âœ… èŠå¤©æ¶ˆæ¯å®ä½“
â”‚   â”‚   â””â”€â”€ biography_entity.dart     # âœ… ä¼ è®°å®ä½“
â”‚   â”œâ”€â”€ enums/                  # âœ… æšä¸¾ç±»å‹
â”‚   â”‚   â””â”€â”€ story_mood.dart     # âœ… æ•…äº‹æƒ…æ„Ÿæšä¸¾
â”‚   â”œâ”€â”€ repositories/           # âœ… ä»“åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ auth_repository.dart      # âœ… è®¤è¯ä»“åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ story_repository.dart     # âœ… æ•…äº‹ä»“åº“æ¥å£
â”‚   â”‚   â””â”€â”€ ai_repository.dart        # âœ… AI ä»“åº“æ¥å£
â”‚   â””â”€â”€ usecases/               # âœ… ç”¨ä¾‹
â”‚       â”œâ”€â”€ auth_usecases.dart        # âœ… è®¤è¯ç”¨ä¾‹
â”‚       â”œâ”€â”€ story_usecases.dart       # âœ… æ•…äº‹ç”¨ä¾‹
â”‚       â””â”€â”€ ai_chat_usecases.dart     # âœ… AI èŠå¤©ç”¨ä¾‹
â”œâ”€â”€ presentation/               # âœ… è¡¨ç°å±‚
â”‚   â”œâ”€â”€ pages/                  # âœ… é¡µé¢
â”‚   â”‚   â”œâ”€â”€ auth/              # âœ… è®¤è¯é¡µé¢ (ç™»å½•ã€æ³¨å†Œ)
â”‚   â”‚   â”œâ”€â”€ home/              # âœ… é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ story/             # âœ… æ•…äº‹é¡µé¢ (åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€ç¼–è¾‘)
â”‚   â”‚   â”œâ”€â”€ chat/              # âœ… AI å¯¹è¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ biography/         # âœ… ä¼ è®°é¡µé¢
â”‚   â”‚   â”œâ”€â”€ social/            # âœ… ç¤¾äº¤å¹¿åœº
â”‚   â”‚   â”œâ”€â”€ search/            # âœ… æœç´¢é¡µé¢
â”‚   â”‚   â””â”€â”€ settings/          # âœ… è®¾ç½®é¡µé¢
â”‚   â”œâ”€â”€ widgets/               # âœ… é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/            # âœ… é€šç”¨ç»„ä»¶ (ç©ºçŠ¶æ€ã€å¡ç‰‡ç­‰)
â”‚   â”‚   â”œâ”€â”€ story/             # âœ… æ•…äº‹ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat/              # âœ… èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â””â”€â”€ biography/         # âœ… ä¼ è®°ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ providers/             # âœ… Riverpod çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth_provider.dart        # âœ… è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ story_provider.dart       # âœ… æ•…äº‹çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ chat_provider.dart        # âœ… èŠå¤©çŠ¶æ€
â”‚   â”‚   â””â”€â”€ search_provider.dart      # âœ… æœç´¢çŠ¶æ€
â”‚   â””â”€â”€ routes/                # âœ… è·¯ç”±é…ç½®
â”‚       â””â”€â”€ app_router.dart    # âœ… GoRouter è·¯ç”±é…ç½®
â”œâ”€â”€ dependency_injection.dart   # âœ… Riverpod ä¾èµ–æ³¨å…¥
â”œâ”€â”€ firebase_options.dart      # âœ… Firebase é…ç½®
â””â”€â”€ main.dart                  # âœ… åº”ç”¨å…¥å£
\`\`\`

### ä¾èµ–å…³ç³»è¯´æ˜ âœ…

- **Presentation** å±‚é€šè¿‡ Riverpod Providers è°ƒç”¨ **Domain** å±‚çš„ UseCases
- **Domain** å±‚çš„ UseCases è°ƒç”¨æŠ½è±¡çš„ Repository æ¥å£
- **Data** å±‚å®ç° Repository æ¥å£ï¼Œåè°ƒå„ç§ DataSources
- æ‰€æœ‰å±‚éƒ½å¯ä»¥ä½¿ç”¨ **Core** å±‚çš„é€šç”¨å·¥å…·å’Œå¸¸é‡
- ä¾èµ–æ³¨å…¥é€šè¿‡ `dependency_injection.dart` ç»Ÿä¸€ç®¡ç†

## 3. æ ¸å¿ƒåŠŸèƒ½å®ç°çŠ¶æ€

### âœ… å·²å®ç°åŠŸèƒ½

1. **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**

   - é‚®ç®±/å¯†ç æ³¨å†Œç™»å½•
   - ä¼šè¯æŒä¹…åŒ–
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†

2. **AI å¯¹è¯ç³»ç»Ÿ**

   - Gemini Pro API é›†æˆ
   - å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç»´æŠ¤
   - å®æ—¶æ¶ˆæ¯å¤„ç†

3. **æ•…äº‹ç®¡ç†ç³»ç»Ÿ**

   - æ•…äº‹åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
   - æ•…äº‹åˆ—è¡¨ä¸è¯¦æƒ…å±•ç¤º
   - æƒ…æ„Ÿæ ‡ç­¾å’Œåˆ†ç±»

4. **ä¼ è®°ç”Ÿæˆç³»ç»Ÿ**

   - åŸºäºæ•…äº‹çš„ä¼ è®°ç”Ÿæˆ
   - å¤šç§ç”Ÿæˆé£æ ¼æ”¯æŒ
   - ä¼ è®°ä¿å­˜å’Œç®¡ç†

5. **æœç´¢ç³»ç»Ÿ**

   - æ•…äº‹å†…å®¹æœç´¢
   - æƒ…æ„Ÿç­›é€‰
   - æ ‡ç­¾ç­›é€‰

6. **ç¤¾äº¤ç³»ç»Ÿ**

   - å…¬å¼€æ•…äº‹æµè§ˆ
   - ç‚¹èµåŠŸèƒ½æ¶æ„

7. **å¤šåª’ä½“æ”¯æŒ**
   - å›¾ç‰‡ä¸Šä¼ ä¸å±•ç¤º
   - Firebase Storage é›†æˆ

## 4. æŠ€æœ¯æ ˆæ›´æ–°çŠ¶æ€

### âœ… å·²é‡‡ç”¨æŠ€æœ¯

- **å‰ç«¯**: Flutter 3.1.0+ (Dart)
- **çŠ¶æ€ç®¡ç†**: Riverpod 2.4+ âœ…
- **è·¯ç”±**: GoRouter 12.1+ âœ…
- **åç«¯**: Firebase å…¨å®¶æ¡¶ âœ…
- **AI**: Google Gemini Pro API âœ…
- **ç½‘ç»œ**: Dio 5.4+ âœ…
- **JSON**: json_serializable + Freezed âœ…
- **ä»£ç ç”Ÿæˆ**: build_runner âœ…

### ğŸ“‹ å¼€å‘å·¥å…·é“¾

- **IDE**: VS Code / Cursor âœ…
- **ç‰ˆæœ¬æ§åˆ¶**: Git âœ…
- **CI/CD**: ğŸš§ å¾…é…ç½®
- **æµ‹è¯•**: flutter_test âœ…
- **ä»£ç æ£€æŸ¥**: flutter_lints âœ…

---

> **æ€»ç»“**: å½“å‰ MVP ç‰ˆæœ¬å·²å®ç°æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒæŠ€æœ¯æ¶æ„ç¨³å®šå¯é ã€‚æ–‡æ¡£å†…å®¹ä¸å®é™…å®ç°é«˜åº¦ä¸€è‡´ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚
